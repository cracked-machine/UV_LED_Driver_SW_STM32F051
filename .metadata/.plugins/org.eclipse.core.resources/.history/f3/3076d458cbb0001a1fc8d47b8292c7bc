/*
 * UVBOX_Manager.c
 *
 *  Created on: Jun 17, 2020
 *      Author: chris
 */


#include "UvboxManager.h"
#include "RotaryEncoder.h"

UVBOX_LidStatusTypedef eLidStatus = UVBOX_LIDOPEN;
uint16_t debounce_last_interrupt_time = 0;

void UM_Setup()
{

	  // PWM OUTPUTS

	  HAL_TIM_PWM_Start(&htim1, TIM_CHANNEL_1);
	  HAL_TIM_PWM_Start(&htim1, TIM_CHANNEL_2);
	  HAL_TIM_PWM_Start(&htim1, TIM_CHANNEL_3);
	  HAL_TIM_PWM_Start(&htim1, TIM_CHANNEL_4);
	  HAL_TIM_PWM_Start(&htim14, TIM_CHANNEL_1);

	  TIM1->ARR = 0xFF;		// 	255
	  TIM1->CCR1 = 0x00;	// 	31	12.5%
	  TIM1->CCR2 = 0x00;	//	63	25%
	  TIM1->CCR3 = 0x00;	//	127 50%
	  TIM1->CCR4 = 0x00;	//  191 75%

	  TIM14->ARR = 0xFF;	// 	255
	  TIM14->CCR1 = MAX_ENCODER_LIMIT;

	  // debounce timer
	  HAL_TIM_Base_Start(&htim17);

	  // status output LED
	  HAL_GPIO_WritePin(GPIOA, STATUS_BLUE_Pin, GPIO_PIN_SET);
	  HAL_GPIO_WritePin(GPIOA, STATUS_RED_Pin, GPIO_PIN_RESET);
	  HAL_GPIO_WritePin(GPIOA, STATUS_GREEN_Pin, GPIO_PIN_SET);

	  // rotary encoder
	  RE_Setup();

}

void UM_SetDebounceTime(uint16_t pDebounceTime)
{
	debounce_last_interrupt_time = pDebounceTime;
}

uint16_t UM_getDebounceTime()
{

}

