/*
 * UVBOX_Manager.c
 *
 *  Created on: Jun 17, 2020
 *      Author: chris
 */


#include "uvbox_Manager.h"

// STMCube-generated HAL declaraitons
#include "tim.h"
#include "gpio.h"

void UVBOX_Setup()
{

	  // PWM OUTPUTS
	  HAL_TIM_Base_Start(&htim17);
	  HAL_TIM_PWM_Start(&htim1, TIM_CHANNEL_1);
	  HAL_TIM_PWM_Start(&htim1, TIM_CHANNEL_2);
	  HAL_TIM_PWM_Start(&htim1, TIM_CHANNEL_3);
	  HAL_TIM_PWM_Start(&htim1, TIM_CHANNEL_4);
	  HAL_TIM_PWM_Start(&htim14, TIM_CHANNEL_1);

	  TIM1->ARR = 0xFF;		// 	255
	  TIM1->CCR1 = 0x00;	// 	31	12.5%
	  TIM1->CCR2 = 0x00;	//	63	25%
	  TIM1->CCR3 = 0x00;	//	127 50%
	  TIM1->CCR4 = 0x00;	//  191 75%

	  TIM14->ARR = 0xFF;	// 	255
	  TIM14->CCR1 = MAX_ENCODER_LIMIT;

	  // LED OUTPUT
	  HAL_GPIO_WritePin(GPIOA, STATUS_BLUE_Pin, GPIO_PIN_SET);
	  HAL_GPIO_WritePin(GPIOA, STATUS_RED_Pin, GPIO_PIN_RESET);
	  HAL_GPIO_WritePin(GPIOA, STATUS_GREEN_Pin, GPIO_PIN_SET);

	  // rotary encoder
	  HAL_TIM_Base_Start(&htim2);
	  uint8_t previous_encoder_dir = (TIM2->CR1 & TIM_CR1_DIR);
}
